<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Funnel+Sans:ital,wght@0,300..800;1,300..800&family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <title>Purchased Items</title>
    <script>
      function initPage() {
        var username = window.localStorage.getItem("username");
        var acctType = window.localStorage.getItem("acctType");

        if (!username) {
          alert("You must be logged in to view your cart.");
          window.location.href = "/login";
          return;
        }
        var header = document.getElementById("cart_header");
        header.innerText = username + "'s purchased items";

        var list = document.getElementById("cartList");
        list.innerHTML = "<li>Loading cart...</li>";

        fetch("/api/purchased/" + encodeURIComponent(username))
          .then(function (res) {
            return res.json();
          })
          .then(function (data) {
            var purchased = data.purchased || [];
            list.innerHTML = "";

            if (purchased.length == 0) {
              list.innerHTML = "<li>Your purchased is empty.</li>";
              return;
            }

            for (var i = 0; i < purchased.length; i++) {
              var item = purchased[i];
              var li = document.createElement("li");
              var text = item.name || "Unnamed Product";
              if (item.price != undefined) {
                text += " - $" + item.price;
              }
              if (item.description) {
                text += " (" + item.description + ")";
              }

              var span = document.createElement("span");
              span.innerText = text + " ";
              li.appendChild(span);
              list.appendChild(li);
            }
          })
          .catch(function (err) {
            console.log(err);
            list.innerHTML = "<li>Error fetching purchased.</li>";
          });
      }
    </script>
  </head>
  <body onload="initPage()">
    <header>
      <h1 id="cart_header">Buyer's Shopping Cart</h1>
    </header>
    <nav>
      <a href="/home">Home</a>
      <a href="/login">Login</a>
    </nav>
    <div class="pageText">
      <h2>Your Shopping Cart:</h2>
      <ul id="cartList">
        <li>
          No products in your shopping cart yet! Please feel free to browse from
          our wonderfull sellers!
        </li>
      </ul>
    </div>
    <footer></footer>
  </body>
</html>
